#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ç”¨æˆ¶é«”é©—æ”¹é€²å·¥å…·
æ™ºèƒ½æç¤ºã€éŒ¯èª¤æ¢å¾©ã€ç”¨æˆ¶å¼•å°ç­‰
"""

import random
from datetime import datetime

class UserExperience:
    def __init__(self):
        self.welcome_messages = [
            "æ­¡è¿ä¾†åˆ° MomsHeroï¼ğŸ‘©â€ğŸ³ æˆ‘æ˜¯æ‚¨çš„å°ˆå±¬æ–™ç†åŠ©æ‰‹ï¼Œè«‹å‘Šè¨´æˆ‘æ‚¨æœ‰å“ªäº›é£Ÿæï¼Œæˆ‘æœƒç‚ºæ‚¨æ¨è–¦é©åˆçš„æ–™ç†ï¼",
            "å—¨ï¼æˆ‘æ˜¯ MomsHero æ–™ç†åŠ©æ‰‹ ğŸ³ è®“æˆ‘å¹«æ‚¨æŠŠé£Ÿæè®Šæˆç¾å‘³æ–™ç†å§ï¼è«‹åˆ†äº«æ‚¨çš„é£Ÿæï½",
            "æ­¡è¿ä½¿ç”¨ MomsHeroï¼ğŸ¥˜ æˆ‘æ˜¯æ‚¨çš„æ–™ç†å°å¹«æ‰‹ï¼Œè«‹å‘Šè¨´æˆ‘æ‚¨æ‰‹é‚Šæœ‰ä»€éº¼é£Ÿæï¼Œæˆ‘ä¾†ç‚ºæ‚¨è¦åŠƒæ–™ç†ï¼"
        ]
        
        self.ingredient_examples = [
            "ä¾‹å¦‚ï¼šé›è›‹ã€ç™½é£¯ã€è”¥",
            "ä¾‹å¦‚ï¼šè±¬è‚‰ã€é’èœã€è±†è…", 
            "ä¾‹å¦‚ï¼šé›èƒ¸è‚‰ã€èƒ¡è˜¿è””ã€æ´‹è”¥",
            "ä¾‹å¦‚ï¼šé®­é­šã€ç§‹è‘µã€æ¾éœ²"
        ]
        
        self.quota_error_messages = [
            "æŠ±æ­‰ï¼ŒAI æœå‹™çš„å…è²»é¡åº¦å·²ç”¨å®Œã€‚è«‹ç¨å¾Œå†è©¦ï¼Œæˆ–è€ƒæ…®å‡ç´šåˆ°ä»˜è²»ç‰ˆæœ¬ã€‚",
            "ç›®å‰ AI æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼ˆé…é¡å·²ç”¨å®Œï¼‰ã€‚è«‹ç¨å¾Œå†è©¦ï¼",
            "AI æœå‹™æš«æ™‚ä¼‘æ¯ä¸­ï¼ˆå…è²»é¡åº¦ç”¨å®Œï¼‰ã€‚è«‹ç¨å¾Œå†ä¾†æ‰¾æˆ‘èŠå¤©å§ï¼"
        ]
        
        self.help_messages = [
            "ğŸ’¡ ä½¿ç”¨æç¤ºï¼š\nâ€¢ å‘Šè¨´æˆ‘æ‚¨çš„é£Ÿæï¼Œæˆ‘æœƒæ¨è–¦æ–™ç†\nâ€¢ é¸æ“‡æ–™ç†ç·¨è™ŸæŸ¥çœ‹è©³ç´°é£Ÿè­œ\nâ€¢ è¼¸å…¥ã€Œé‡æ–°é–‹å§‹ã€é‡ç½®å°è©±\nâ€¢ è¼¸å…¥ã€Œå¹«åŠ©ã€æŸ¥çœ‹æ­¤è¨Šæ¯",
            "ğŸ“– ä½¿ç”¨èªªæ˜ï¼š\nâ€¢ åˆ†äº«é£Ÿæ â†’ ç²å¾—æ¨è–¦\nâ€¢ é¸æ“‡æ–™ç† â†’ æŸ¥çœ‹é£Ÿè­œ\nâ€¢ è©¢å•æ›¿ä»£ â†’ ç²å¾—å»ºè­°\nâ€¢ é‡æ–°é–‹å§‹ â†’ é‡ç½®å°è©±",
            "ğŸ¯ å¿«é€Ÿé–‹å§‹ï¼š\n1. å‘Šè¨´æˆ‘æ‚¨çš„é£Ÿæ\n2. å¾æ¨è–¦ä¸­é¸æ“‡æ–™ç†\n3. æŸ¥çœ‹è©³ç´°é£Ÿè­œ\n4. è©¢å•æ›¿ä»£æ–¹æ¡ˆ"
        ]
    
    def get_welcome_message(self):
        """ç²å–æ­¡è¿è¨Šæ¯"""
        message = random.choice(self.welcome_messages)
        examples = random.sample(self.ingredient_examples, 2)
        
        return f"{message}\n\n{examples[0]}\n{examples[1]}"
    
    def get_quota_error_message(self):
        """ç²å–é…é¡éŒ¯èª¤è¨Šæ¯"""
        return random.choice(self.quota_error_messages)
    
    def get_help_message(self):
        """ç²å–å¹«åŠ©è¨Šæ¯"""
        return random.choice(self.help_messages)
    
    def get_smart_prompt(self, user_message, conversation_history=None):
        """æ ¹æ“šç”¨æˆ¶è¨Šæ¯å’Œå°è©±æ­·å²æä¾›æ™ºèƒ½æç¤º"""
        # æª¢æ¸¬ç”¨æˆ¶å¯èƒ½çš„æ„åœ–
        if any(word in user_message for word in ['ä¸æœƒ', 'ä¸æ‡‚', 'æ€éº¼', 'å¦‚ä½•']):
            return "éœ€è¦æˆ‘ç‚ºæ‚¨è©³ç´°èªªæ˜å—ï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æƒ³äº†è§£ä»€éº¼ï¼"
        
        if any(word in user_message for word in ['è¬è¬', 'æ„Ÿè¬', 'è¬è¬ä½ ']):
            return "ä¸å®¢æ°£ï¼å¾ˆé«˜èˆˆèƒ½å¹«åˆ°æ‚¨ã€‚å¦‚æœé‚„æœ‰å…¶ä»–å•é¡Œï¼Œéš¨æ™‚å‘Šè¨´æˆ‘ï¼"
        
        if any(word in user_message for word in ['å†è¦‹', 'æ°æ°', 'æ‹œæ‹œ']):
            return "å†è¦‹ï¼å¸Œæœ›ä»Šå¤©çš„æ–™ç†å»ºè­°å°æ‚¨æœ‰å¹«åŠ©ã€‚ä¸‹æ¬¡è¦‹ï¼ğŸ‘‹"
        
        if any(word in user_message for word in ['å¥½åƒ', 'ç¾å‘³', 'è®š']):
            return "å¤ªå¥½äº†ï¼å¾ˆé«˜èˆˆæ‚¨å–œæ­¡ã€‚å¦‚æœé‚„éœ€è¦å…¶ä»–æ–™ç†å»ºè­°ï¼Œéš¨æ™‚å‘Šè¨´æˆ‘ï¼"
        
        return None
    
    def get_retry_suggestion(self, error_type):
        """æ ¹æ“šéŒ¯èª¤é¡å‹æä¾›é‡è©¦å»ºè­°"""
        suggestions = {
            "quota": "å»ºè­°ï¼š\nâ€¢ ç¨å¾Œå†è©¦ï¼ˆé…é¡å¯èƒ½å·²é‡ç½®ï¼‰\nâ€¢ è€ƒæ…®å‡ç´šåˆ°ä»˜è²»ç‰ˆæœ¬\nâ€¢ ä½¿ç”¨å…¶ä»–æ™‚é–“æ¸¬è©¦",
            "network": "å»ºè­°ï¼š\nâ€¢ æª¢æŸ¥ç¶²è·¯é€£æ¥\nâ€¢ ç¨å¾Œå†è©¦\nâ€¢ å¦‚æœå•é¡ŒæŒçºŒï¼Œè«‹è¯ç¹«æ”¯æ´",
            "general": "å»ºè­°ï¼š\nâ€¢ ç¨å¾Œå†è©¦\nâ€¢ é‡æ–°è¼¸å…¥æ‚¨çš„éœ€æ±‚\nâ€¢ å¦‚æœå•é¡ŒæŒçºŒï¼Œè«‹è¯ç¹«æ”¯æ´"
        }
        
        return suggestions.get(error_type, suggestions["general"])
    
    def get_conversation_flow_hint(self, stage):
        """æ ¹æ“šå°è©±éšæ®µæä¾›æµç¨‹æç¤º"""
        hints = {
            "idle": "ğŸ’¡ æç¤ºï¼šå‘Šè¨´æˆ‘æ‚¨æœ‰å“ªäº›é£Ÿæï¼Œæˆ‘æœƒç‚ºæ‚¨æ¨è–¦æ–™ç†ï¼",
            "waiting_for_ingredients": "ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥é¸æ“‡æ¨è–¦çš„æ–™ç†ç·¨è™Ÿï¼Œæˆ–æä¾›æ›´å¤šé£Ÿæ",
            "waiting_for_choice": "ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥è©¢å•æ›¿ä»£æ–¹æ¡ˆï¼Œæˆ–é¸æ“‡å…¶ä»–æ–™ç†",
            "waiting_for_feedback": "ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥è©¢å•æ›´å¤šç´°ç¯€ï¼Œæˆ–é–‹å§‹æ–°çš„å°è©±"
        }
        
        return hints.get(stage, "")
    
    def format_ingredient_suggestion(self, ingredients):
        """æ ¼å¼åŒ–é£Ÿæå»ºè­°"""
        if not ingredients:
            return "è«‹å‘Šè¨´æˆ‘æ‚¨æœ‰å“ªäº›é£Ÿæï¼Œæˆ‘æœƒç‚ºæ‚¨æ¨è–¦é©åˆçš„æ–™ç†ï¼"
        
        suggestion = f"æ ¹æ“šæ‚¨æä¾›çš„é£Ÿæï¼š{', '.join(ingredients)}\n\n"
        suggestion += "æˆ‘ç‚ºæ‚¨æ¨è–¦ä»¥ä¸‹æ–™ç†ï¼š\n"
        
        return suggestion
    
    def get_encouragement_message(self):
        """ç²å–é¼“å‹µè¨Šæ¯"""
        encouragements = [
            "ğŸ’ª æ‚¨åšå¾—å¾ˆæ£’ï¼ç¹¼çºŒæ¢ç´¢æ›´å¤šç¾å‘³æ–™ç†å§ï¼",
            "ğŸŒŸ æ¯å€‹å¤§å»šéƒ½æ˜¯å¾ç°¡å–®çš„æ–™ç†é–‹å§‹çš„ï¼Œæ‚¨å·²ç¶“å¾ˆæ£’äº†ï¼",
            "ğŸ‰ æ–™ç†çš„æ¨‚è¶£å°±åœ¨æ–¼å˜—è©¦ï¼Œæ‚¨æ­£åœ¨åšå¾ˆæ£’çš„äº‹æƒ…ï¼",
            "ğŸ‘ æ‚¨çš„æ–™ç†ç†±æƒ…è®“æˆ‘å°è±¡æ·±åˆ»ï¼Œç¹¼çºŒåŠ æ²¹ï¼"
        ]
        
        return random.choice(encouragements)

# å…¨åŸŸç”¨æˆ¶é«”é©—å¯¦ä¾‹
user_experience = UserExperience() 